package com.zmen.backend.entity;

import jakarta.persistence.*;
import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.Set;

@Entity
@Table(name = "gio_hang")
public class GioHang {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne
    @JoinColumn(name = "nguoi_dung_id", referencedColumnName = "id")
    private User nguoiDung;
    
    @Column(name = "session_id", length = 255)
    private String sessionId; // For guest users
    
    @Column(name = "tong_so_luong")
    private Integer tongSoLuong = 0;
    
    @Column(name = "tong_tien", precision = 15, scale = 2)
    private BigDecimal tongTien = BigDecimal.ZERO;
    
    @Column(name = "tong_tien_giam_gia", precision = 15, scale = 2)
    private BigDecimal tongTienGiamGia = BigDecimal.ZERO;
    
    @Column(name = "ma_voucher", length = 50)
    private String maVoucher;
    
    @Column(name = "gia_tri_voucher", precision = 15, scale = 2)
    private BigDecimal giaTriVoucher = BigDecimal.ZERO;
    
    @Column(name = "trang_thai")
    private String trangThai = "ACTIVE"; // ACTIVE, CHECKOUT, ABANDONED
    
    @Column(name = "created_at")
    private LocalDateTime createdAt;
    
    @Column(name = "updated_at")
    private LocalDateTime updatedAt;
    
    @OneToMany(mappedBy = "gioHang", cascade = CascadeType.ALL)
    private Set<ChiTietGioHang> chiTietGioHangs;
    
    @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
        updatedAt = LocalDateTime.now();
    }
    
    @PreUpdate
    protected void onUpdate() {
        updatedAt = LocalDateTime.now();
    }
    
    // Constructors
    public GioHang() {}
    
    public GioHang(User nguoiDung) {
        this.nguoiDung = nguoiDung;
    }
    
    public GioHang(String sessionId) {
        this.sessionId = sessionId;
    }
    
    // Getters and Setters
    public Long getId() {
        return id;
    }
    
    public void setId(Long id) {
        this.id = id;
    }
    
    public User getNguoiDung() {
        return nguoiDung;
    }
    
    public void setNguoiDung(User nguoiDung) {
        this.nguoiDung = nguoiDung;
    }
    
    public String getSessionId() {
        return sessionId;
    }
    
    public void setSessionId(String sessionId) {
        this.sessionId = sessionId;
    }
    
    public Integer getTongSoLuong() {
        return tongSoLuong;
    }
    
    public void setTongSoLuong(Integer tongSoLuong) {
        this.tongSoLuong = tongSoLuong;
    }
    
    public BigDecimal getTongTien() {
        return tongTien;
    }
    
    public void setTongTien(BigDecimal tongTien) {
        this.tongTien = tongTien;
    }
    
    public BigDecimal getTongTienGiamGia() {
        return tongTienGiamGia;
    }
    
    public void setTongTienGiamGia(BigDecimal tongTienGiamGia) {
        this.tongTienGiamGia = tongTienGiamGia;
    }
    
    public String getMaVoucher() {
        return maVoucher;
    }
    
    public void setMaVoucher(String maVoucher) {
        this.maVoucher = maVoucher;
    }
    
    public BigDecimal getGiaTriVoucher() {
        return giaTriVoucher;
    }
    
    public void setGiaTriVoucher(BigDecimal giaTriVoucher) {
        this.giaTriVoucher = giaTriVoucher;
    }
    
    public String getTrangThai() {
        return trangThai;
    }
    
    public void setTrangThai(String trangThai) {
        this.trangThai = trangThai;
    }
    
    public LocalDateTime getCreatedAt() {
        return createdAt;
    }
    
    public void setCreatedAt(LocalDateTime createdAt) {
        this.createdAt = createdAt;
    }
    
    public LocalDateTime getUpdatedAt() {
        return updatedAt;
    }
    
    public void setUpdatedAt(LocalDateTime updatedAt) {
        this.updatedAt = updatedAt;
    }
    
    public Set<ChiTietGioHang> getChiTietGioHangs() {
        return chiTietGioHangs;
    }
    
    public void setChiTietGioHangs(Set<ChiTietGioHang> chiTietGioHangs) {
        this.chiTietGioHangs = chiTietGioHangs;
    }
}

